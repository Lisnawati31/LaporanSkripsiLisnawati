{"version":3,"sources":["utils.js"],"names":["utils","source","target","Array","prototype","slice","call","attributes","forEach","attribute","setAttribute","name","value","fn","delay","debounced","args","arguments","cancelDebounce","id","setTimeout","clearTimeout","getCurrentBrowserPathWithoutHash","window","location","hash","pathname","search","node","offsetLeft","offsetTop","offsetParent","url","uri","getPathname","getSearch","getHash","currentBrowserPath","getUrlPathWithoutHash","getUrlPath","matchUserAgent","isOpera","isEdge","isIe","isChrome","str","navigator","userAgent","indexOf","history","pushState","err","console","error","message","removeAttribute","elements","element","path","length","substr","href","Math","random","referrer","Object","defineProperty","document","configurable","get"],"mappings":"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","file":"src/utils/utils.js","sourcesContent":["'use strict';\n\nimport { exitDocument } from 'metal-dom';\nimport globals from '../globals/globals';\nimport Uri from 'metal-uri';\n\n/**\n * A collection of static utility functions.\n * @const\n */\nclass utils {\n\n\t/**\n\t * Copies attributes form source node to target node.\n\t * @return {void}\n\t * @static\n\t */\n\tstatic copyNodeAttributes(source, target) {\n\t\tArray.prototype.slice.call(source.attributes).forEach((attribute) => target.setAttribute(attribute.name, attribute.value));\n\t}\n\n\t/**\n\t * Debounces function execution.\n\t * @param {!function()} fn\n\t * @param {number} delay\n\t * @return {!function()}\n\t */\n\tstatic debounce(fn, delay) {\n\t\treturn function debounced() {\n\t\t\tconst args = arguments;\n\t\t\tutils.cancelDebounce(debounced);\n\t\t\tdebounced.id = setTimeout(function() {\n\t\t\t\tfn(Array.prototype.slice.call(args));\n\t\t\t}, delay);\n\t\t};\n\t}\n\n\t/**\n\t * Cancels the scheduled debounced function.\n\t * @param {function()} debounced\n\t */\n\tstatic cancelDebounce(debounced) {\n\t\tclearTimeout(debounced.id);\n\t}\n\n\t/**\n\t * Gets the current browser path including hashbang.\n\t * @return {!string}\n\t * @static\n\t */\n\tstatic getCurrentBrowserPath() {\n\t\treturn this.getCurrentBrowserPathWithoutHash() + globals.window.location.hash;\n\t}\n\n\t/**\n\t * Gets the current browser path excluding hashbang.\n\t * @return {!string}\n\t * @static\n\t */\n\tstatic getCurrentBrowserPathWithoutHash() {\n\t\treturn globals.window.location.pathname + globals.window.location.search;\n\t}\n\n\t/**\n\t * Gets the given node offset coordinates.\n\t * @return {!object}\n\t * @static\n\t */\n\tstatic getNodeOffset(node) {\n\t\tlet [offsetLeft, offsetTop] = [0, 0];\n\t\tdo {\n\t\t\toffsetLeft += node.offsetLeft;\n\t\t\toffsetTop += node.offsetTop;\n\t\t\tnode = node.offsetParent;\n\t\t} while (node);\n\t\treturn {\n\t\t\toffsetLeft,\n\t\t\toffsetTop\n\t\t};\n\t}\n\n\t/**\n\t * Extracts the path part of an url.\n\t * @return {!string}\n\t * @static\n\t */\n\tstatic getUrlPath(url) {\n\t\tvar uri = new Uri(url);\n\t\treturn uri.getPathname() + uri.getSearch() + uri.getHash();\n\t}\n\n\t/**\n\t * Extracts the path part of an url without hashbang.\n\t * @return {!string}\n\t * @static\n\t */\n\tstatic getUrlPathWithoutHash(url) {\n\t\tvar uri = new Uri(url);\n\t\treturn uri.getPathname() + uri.getSearch();\n\t}\n\n\t/**\n\t * Extracts the path part of an url without hashbang and query search.\n\t * @return {!string}\n\t * @static\n\t */\n\tstatic getUrlPathWithoutHashAndSearch(url) {\n\t\tvar uri = new Uri(url);\n\t\treturn uri.getPathname();\n\t}\n\n\t/**\n\t * Checks if url is in the same browser current url excluding the hashbang.\n\t * @param  {!string} url\n\t * @return {boolean}\n\t * @static\n\t */\n\tstatic isCurrentBrowserPath(url) {\n\t\tif (url) {\n\t\t\tconst currentBrowserPath = this.getCurrentBrowserPathWithoutHash();\n\t\t\t// the getUrlPath will create a Uri and will normalize the path and\n\t\t\t// remove the trailling '/' for properly comparing paths.\n\t\t\treturn utils.getUrlPathWithoutHash(url) === this.getUrlPath(currentBrowserPath);\n\t\t}\n\t\treturn false;\n\t}\n\n\tstatic isChrome() {\n\t\treturn (utils.matchUserAgent('Chrome') || utils.matchUserAgent('CriOs')) &&\n\t\t\t!utils.isOpera() &&\n\t\t\t!utils.isEdge();\n\t}\n\n\tstatic isEdge() {\n\t\treturn utils.matchUserAgent('Edge');\n\t}\n\n\tstatic isIe() {\n\t\treturn utils.matchUserAgent('Trident') || utils.matchUserAgent('MSIE');\n\t}\n\n\tstatic isIeOrEdge() {\n\t\treturn utils.isIe() || utils.isEdge();\n\t}\n\n\tstatic isOpera() {\n\t\treturn utils.matchUserAgent('Opera') || utils.matchUserAgent('OPR');\n\t}\n\n\tstatic isSafari() {\n\t\treturn utils.matchUserAgent('Safari') &&\n\t\t\t!(utils.isChrome() || utils.isOpera() || utils.isEdge());\n\t}\n\n\tstatic matchUserAgent(str) {\n\t\tconst navigator = globals.window.navigator;\n\t\tif (!navigator || !navigator.userAgent) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst userAgent = navigator.userAgent;\n\t\treturn userAgent.indexOf(str) !== -1;\n\t}\n\n\t/**\n\t * Returns true if HTML5 History api is supported.\n\t * @return {boolean}\n\t * @static\n\t */\n\tstatic isHtml5HistorySupported() {\n\t\treturn !!(globals.window.history && globals.window.history.pushState);\n\t}\n\n\t/**\n\t * Checks if a given url is a valid http(s) uri and returns the formed Uri\n\t * or false if the parsing failed\n\t * @return {Uri|boolean}\n\t * @static\n\t */\n\tstatic isWebUri(url) {\n\t\ttry {\n\t\t\treturn new Uri(url);\n\t\t} catch (err) {\n\t\t\tconsole.error(`${err.message} ${url}`);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Removes all attributes form node.\n\t * @return {void}\n\t * @static\n\t */\n\tstatic clearNodeAttributes(node) {\n\t\tArray.prototype.slice.call(node.attributes).forEach((attribute) => node.removeAttribute(attribute.name));\n\t}\n\n\t/**\n\t * Remove elements from the document.\n\t * @param {!Array<Element>} elements\n\t */\n\tstatic removeElementsFromDocument(elements) {\n\t\telements.forEach((element) => exitDocument(element));\n\t}\n\n\t/**\n\t* Removes trailing slash in path.\n\t* @param {!string}\n\t* @return {string}\n\t*/\n\tstatic removePathTrailingSlash(path) {\n\t\tvar length = path ? path.length : 0;\n\t\tif (length > 1 && path[length - 1] === '/') {\n\t\t\tpath = path.substr(0, length - 1);\n\t\t}\n\t\treturn path;\n\t}\n\n\t/**\n\t * Adds a random suffix to the href attribute of the element.\n\t * @param {!element} element\n\t * @return {element}\n\t */\n\tstatic setElementWithRandomHref(element) {\n\t\telement.href = element.href + '?q=' + Math.random();\n\t\treturn element;\n\t}\n\n\t/**\n\t * Overrides document referrer\n\t * @param {string} referrer\n\t * @static\n\t */\n\tstatic setReferrer(referrer) {\n\t\tObject.defineProperty(globals.document, 'referrer', {\n\t\t\tconfigurable: true,\n\t\t\tget: function() {\n\t\t\t\treturn referrer;\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport default utils;\n"],"sourceRoot":"/source/"}